<?xml version="1.0" encoding="UTF-8"?>

<Bundle xmlns="http://hl7.org/fhir">
    <id value="PMP3-ConsolidatedMedicationCard"/>
    <identifier>
        <system value="urn:ietf:rfc:3986"/>
        <value value="urn:uuid:49ecab84-43e5-4d9d-9ab7-95010744cd51"/>
    </identifier>
    <type value="document"/>
    <timestamp value="2023-02-17T14:10:00+00:00"/>
    <entry>
        <fullUrl value="http://test.fhir.ch/r4/Composition/PMP3-Analyzer"/>
        <resource>
            <Composition>
                <id value="PMP3-Analyzer"/>
                <identifier>
                    <system value="urn:ietf:rfc:3986"/>
                    <value value="urn:uuid:4db23540-b69e-4f8e-ba79-f085b1c2aabb"/>
                </identifier>
                <status value="final"/>
                <type>
                    <coding>
                        <system value="http://snomed.info/sct"/>
                        <code value="721912009"/>
                    </coding>
                </type>
                <subject>
                    <reference value="Patient/MAGMED011"/>
                </subject>
                <date value="2023-02-17T14:10:00+00:00"/>
                <author>
                    <reference value="Device/Analyzer"/>
                </author>
                <title value="Medikationsplan"/>
                <section>
                    <entry>
                        <reference value="MedicationStatement/Header-MedStat-Analyzer"/>
                    </entry>
                </section>
            </Composition>
        </resource>
    </entry>

    <!-- Composition.author -->
    <entry>
        <fullUrl value="http://test.fhir.ch/r4/Device/Analyzer"/>
        <resource>
            <Device>
                <id value="Analyzer"/>
                <deviceName>
                    <name value="Documedis Medical Data Analyzer CE"/>
                    <type value="user-friendly-name"/>
                </deviceName>
                <version>
                    <value value="0.0.0.1"/>
                </version>
            </Device>
        </resource>
    </entry>

    <!--Patient-->
    <entry>
        <fullUrl value="http://test.fhir.ch/r4/Patient/MAGMED011"/>
        <resource>
            <Patient>
                <id value="MAGMED011"/>
                <identifier>
                    <use value="official"/>
                    <type>
                        <coding>
                            <system value="http://terminology.hl7.org/CodeSystem/v2-0203"/>
                            <code value="MR"/>
                        </coding>
                    </type>
                    <system value="urn:oid:2.16.756.5.30.1.191.1.0.2.1"/>
                    <value value="e7963774-9098-445f-9cab-5d52234b52c3"/>
                </identifier>
                <identifier>
                    <use value="secondary"/>
                    <type>
                        <coding>
                            <system value="http://terminology.hl7.org/CodeSystem/v2-0203"/>
                            <code value="MR"/>
                        </coding>
                    </type>
                    <system value="urn:oid:2.16.756.5.30.1.191.1.0.12.3.101"/>
                    <value value="e04f4689-6402-4b1c-a62e-33cb4d4f32e7"/>
                </identifier>
                <identifier>
                    <use value="secondary"/>
                    <type>
                        <coding>
                            <system value="http://terminology.hl7.org/CodeSystem/v2-0203"/>
                            <code value="MR"/>
                        </coding>
                    </type>
                    <system value="urn:oid:2.16.756.5.30.1.128.4.1.4.2.3.2.1.1.1"/>
                    <value value="99146299"/>
                </identifier>
                <identifier>
                    <use value="secondary"/>
                    <type>
                        <coding>
                            <system value="http://terminology.hl7.org/CodeSystem/v2-0203"/>
                            <code value="MR"/>
                        </coding>
                    </type>
                    <system value="urn:oid:2.16.756.5.30.1.196.3.2.1"/>
                    <value value="MAGMED011"/>
                </identifier>
                <identifier>
                    <use value="secondary"/>
                    <type>
                        <coding>
                            <system value="http://terminology.hl7.org/CodeSystem/v2-0203"/>
                            <code value="MR"/>
                        </coding>
                    </type>
                    <system value="urn:oid:2.16.756.5.30.1.196.3.2.1"/>
                    <value value="MAGMED001"/>
                </identifier>
                <active value="true"/>
                <name>
                    <family value="NEFF-WINGEIER"/>
                    <given value="Trong Sang"/>
                </name>
                <gender value="male"/>
                <birthDate value="1987-10-08"/>
            </Patient>
        </resource>
    </entry>

    <!--PractitionerRole MedStat-->
    <entry>
        <fullUrl value="http://test.fhir.ch/r4/PractitionerRole/practitioner-role-1"/>
        <resource>
            <PractitionerRole>
                <id value="practitioner-role-1"/>
                <practitioner>
                    <reference value="Practitioner/practitioner-1"/>
                </practitioner>
                <organization>
                    <reference value="Organization/organization-1"/>
                </organization>
            </PractitionerRole>
        </resource>
    </entry>
    <entry>
        <fullUrl value="http://test.fhir.ch/r4/Practitioner/practitioner-1"/>
        <resource>
            <Practitioner>
                <id value="practitioner-1"/>
                <identifier>
                    <system value="urn:oid:2.51.1.3"/>
                    <value value="7601000201041"/>
                </identifier>
                <name>
                    <family value="Rochat"/>
                    <given value="Dr"/>
                    <prefix value="Dr. med."/>
                </name>
            </Practitioner>
        </resource>
    </entry>
    <entry>
        <fullUrl value="http://test.fhir.ch/r4/Organization/organization-1"/>
        <resource>
            <Organization>
                <id value="organization-1"/>
                <identifier>
                    <system value="urn:oid:2.51.1.3"/>
                    <value value="7601000201041"/>
                </identifier>
                <name value="Médecin de famille"/>
                <address>
                    <line value="Krankenstrasse 2"/>
                    <city value="Zürich"/>
                    <postalCode value="8005"/>
                    <country value="CH"/>
                </address>
            </Organization>
        </resource>
    </entry>

    <!--PractitionerRole-Observation-->
    <entry>
        <fullUrl value="http://test.fhir.ch/r4/PractitionerRole/pr1"/>
        <resource>
            <PractitionerRole>
                <id value="pr1"/>
                <practitioner>
                    <reference value="Practitioner/p1"/>
                </practitioner>
                <organization>
                    <reference value="Organization/o2"/>
                </organization>
            </PractitionerRole>
        </resource>
    </entry>
    <entry>
        <fullUrl value="http://test.fhir.ch/r4/Practitioner/p1"/>
        <resource>
            <Practitioner>
                <id value="p1"/>
                <identifier>
                    <system value="urn:oid:2.51.1.3"/>
                    <value value="7601000876546"/>
                </identifier>
                <name>
                    <family value="Pharm"/>
                    <given value="Pharmacien"/>
                </name>
            </Practitioner>
        </resource>
    </entry>
    <entry>
        <fullUrl value="http://test.fhir.ch/r4/Organization/o2"/>
        <resource>
            <Organization>
                <id value="o2"/>
                <identifier>
                    <system value="urn:oid:2.51.1.3"/>
                    <value value="7601000876546"/>
                </identifier>
                <name value="Pharmacie"/>
                <address>
                    <line value="Apothekerstrasse 22"/>
                    <city value="Zürich"/>
                    <postalCode value="8005"/>
                    <country value="CH"/>
                </address>
            </Organization>
        </resource>
    </entry>

    <!-- MedStat -->
    <entry>
        <fullUrl value="http://test.fhir.ch/r4/MedicationStatement/PMP-MedStat"/>
        <resource>
            <MedicationStatement>
                <id value="PMP-MedStat"/>
                <contained>
                    <Medication>
                        <id value="medication-1"/>
                        <code>
                            <coding>
                                <system value="urn:oid:2.51.1.1"/>
                                <code value="7680563180079"/>
                                <display value="DAFALGAN cpr pell 1 g blister 40 pce"/>
                            </coding>
                            <text value="DAFALGAN cpr pell 1 g blister 40 pce"/>
                        </code>
                        <form>
                            <coding>
                                <system value="urn:oid:0.4.0.127.0.16.1.1.2.1"/>
                                <code value="10221000"/>
                                <display value="Film-coated tablet"/>
                            </coding>
                        </form>
                        <amount>
                            <numerator>
                                <value value="40"/>
                                <unit value="Piece(s)"/>
                                <system value="http://unitsofmeasure.org"/>
                                <code value="{Piece}"/>
                            </numerator>
                            <denominator>
                                <value value="1"/>
                                <unit value="Package"/>
                                <system value="http://unitsofmeasure.org"/>
                                <code value="{Package}"/>
                            </denominator>
                        </amount>
                        <ingredient>
                            <itemCodeableConcept>
                                <coding>
                                    <system value="http://snomed.info/sct"/>
                                    <code value="387517004"/>
                                    <display value="Paracetamol (substance)"/>
                                </coding>
                                <text value="Paracétamol"/>
                            </itemCodeableConcept>
                            <strength>
                                <numerator>
                                    <value value="1"/>
                                    <unit value="gram"/>
                                    <system value="http://unitsofmeasure.org"/>
                                    <code value="g"/>
                                </numerator>
                                <denominator>
                                    <value value="1"/>
                                    <unit value="Tablet (unit of presentation)"/>
                                    <system value="http://snomed.info/sct"/>
                                    <code value="732936001"/>
                                </denominator>
                            </strength>
                        </ingredient>
                    </Medication>
                </contained>
                <extension url="http://hcisolutions.ch/ig/analyzer/StructureDefinition/infoinputdocument">
                    <extension url="http://hcisolutions.ch/ig/analyzer/StructureDefinition/inputdocumentsource">
                        <valueString value="PMP"/>
                    </extension>
                    <extension url="http://hcisolutions.ch/ig/analyzer/StructureDefinition/inputdocumenttype">
                        <valueCodeableConcept>
                            <coding>
                                <system value="http://loinc.org"/>
                                <code value="56445-0"/>
                            </coding>
                            <text value="Medication List"/>
                        </valueCodeableConcept>
                    </extension>
                    <extension url="http://hcisolutions.ch/ig/analyzer/StructureDefinition/inputdocumentdate">
                        <valueDateTime value="2023-02-17T12:30:07.603+00:00"/>
                    </extension>
                    <extension url="http://hcisolutions.ch/ig/analyzer/StructureDefinition/parentdocumentid">
                        <valueIdentifier>
                            <system value="urn:ietf:rfc:3986"/>
                            <value value="urn:uuid:7ccd8e21-f334-42c8-b1b8-f7a46e2ab805"/>
                        </valueIdentifier>
                    </extension>
                </extension>
                <extension url="http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-ext-treatmentplan">
                    <extension url="id">
                        <valueIdentifier>
                            <system value="urn:ietf:rfc:3986"/>
                            <value value="urn:uuid:ce620825-baf3-4c6c-813f-4c5ad9a85a55"/>
                        </valueIdentifier>
                    </extension>
                    <extension url="externalDocumentId">
                        <valueIdentifier>
                            <system value="urn:ietf:rfc:3986"/>
                            <value value="urn:uuid:7ccd8e21-f334-42c8-b1b8-f7a46e2ab805"/>
                        </valueIdentifier>
                    </extension>
                </extension>
                <identifier>
                    <system value="urn:ietf:rfc:3986"/>
                    <value value="urn:uuid:ce620825-baf3-4c6c-813f-4c5ad9a85a55"/>
                </identifier>
                <status value="completed"/>
                <category>
                    <coding>
                        <system value="http://www.whocc.no/atc"/>
                        <code value="N"/>
                        <display value="Nervensystem"/>
                    </coding>
                </category>
                <medicationReference>
                    <reference value="#medication-1"/>
                </medicationReference>
                <subject>
                    <reference value="Patient/MAGMED011"/>
                </subject>
                <informationSource>
                    <reference value="PractitionerRole/practitioner-role-1"/>
                </informationSource>
                <reasonCode>
                    <text value="douleurs"/>
                </reasonCode>
                <dosage id="#dosage-1">
                    <timing>
                        <repeat>
                            <when value="MORN"/>
                            <when value="NOON"/>
                            <when value="EVE"/>
                        </repeat>
                    </timing>
                    <asNeededBoolean value="true"/>
                    <route>
                        <coding>
                            <system value="urn:oid:0.4.0.127.0.16.1.1.2.1"/>
                            <code value="20053000"/>
                            <display value="Oral use"/>
                        </coding>
                    </route>
                    <doseAndRate>
                        <doseQuantity>
                            <value value="1"/>
                            <unit value="Tablet (unit of presentation)"/>
                            <system value="http://snomed.info/sct"/>
                            <code value="732936001"/>
                        </doseQuantity>
                    </doseAndRate>
                </dosage>
            </MedicationStatement>
        </resource>
    </entry>

    <!-- Obs COMMENT -->
    <entry>
        <fullUrl value="http://test.fhir.ch/r4/Observation/PMP-Obs"/>
        <resource>
            <Observation>
                <id value="PMP-Obs"/>
                <extension url="http://hcisolutions.ch/ig/analyzer/StructureDefinition/infoinputdocument">
                    <extension url="http://hcisolutions.ch/ig/analyzer/StructureDefinition/inputdocumentsource">
                        <valueString value="PMP"/>
                    </extension>
                    <extension url="http://hcisolutions.ch/ig/analyzer/StructureDefinition/inputdocumenttype">
                        <valueCodeableConcept>
                            <coding>
                                <system value="http://loinc.org"/>
                                <code value="56445-0"/>
                            </coding>
                            <text value="Medication List"/>
                        </valueCodeableConcept>
                    </extension>
                    <extension url="http://hcisolutions.ch/ig/analyzer/StructureDefinition/inputdocumentdate">
                        <valueDateTime value="2023-02-17T12:30:07.603+00:00"/>
                    </extension>
                    <extension url="http://hcisolutions.ch/ig/analyzer/StructureDefinition/parentdocumentid">
                        <valueIdentifier>
                            <system value="urn:ietf:rfc:3986"/>
                            <value value="urn:uuid:a0ef8362-f56f-40bf-8099-f0c55c533378"/>
                        </valueIdentifier>
                    </extension>
                </extension>
                <extension url="http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-ext-treatmentplan">
                    <extension url="id">
                        <valueIdentifier>
                            <system value="urn:ietf:rfc:3986"/>
                            <value value="urn:uuid:ce620825-baf3-4c6c-813f-4c5ad9a85a55"/>
                        </valueIdentifier>
                    </extension>
                    <extension url="externalDocumentId">
                        <valueIdentifier>
                            <system value="urn:ietf:rfc:3986"/>
                            <value value="urn:uuid:7ccd8e21-f334-42c8-b1b8-f7a46e2ab805"/>
                        </valueIdentifier>
                    </extension>
                </extension>
                <extension url="http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-ext-pharmaceuticaladvice">
                    <extension url="id">
                        <valueIdentifier>
                            <system value="urn:ietf:rfc:3986"/>
                            <value value="urn:uuid:a60ec70c-3089-47b2-84bc-41f0d26f6ff1"/>
                        </valueIdentifier>
                    </extension>
                    <extension url="externalDocumentId">
                        <valueIdentifier>
                            <system value="urn:ietf:rfc:3986"/>
                            <value value="urn:uuid:a0ef8362-f56f-40bf-8099-f0c55c533378"/>
                        </valueIdentifier>
                    </extension>
                </extension>
                <identifier>
                    <system value="urn:ietf:rfc:3986"/>
                    <value value="urn:uuid:a60ec70c-3089-47b2-84bc-41f0d26f6ff1"/>
                </identifier>
                <status value="final"/>
                <code>
                    <coding>
                        <system value="urn:oid:1.3.6.1.4.1.19376.1.9.2.1"/>
                        <code value="COMMENT"/>
                    </coding>
                </code>
                <subject>
                    <reference value="Patient/MAGMED011"/>
                </subject>
                <effectiveDateTime value="2019-02-15T11:00:00+01:00"/>
                <performer>
                    <reference value="PractitionerRole/pr1"/>
                </performer>
                <note>
                    <text value="la patiente n’a pas pris le médicament car pas nécessaire, le Voltarène émulgel a fait son effet"/>
                </note>
            </Observation>
        </resource>
    </entry>

    <!-- Header MedStat -->
    <entry>
        <fullUrl value="http://test.fhir.ch/r4/MedicationStatement/Header-MedStat-Analyzer"/>
        <resource>
            <MedicationStatement>
                <id value="Header-MedStat-Analyzer"/>
                <contained>
                    <Medication>
                        <id value="medication-1"/>
                        <code>
                            <coding>
                                <system value="urn:oid:2.51.1.1"/>
                                <code value="7680563180079"/>
                                <display value="DAFALGAN cpr pell 1 g blister 40 pce"/>
                            </coding>
                            <text value="DAFALGAN cpr pell 1 g blister 40 pce"/>
                        </code>
                        <form>
                            <coding>
                                <system value="urn:oid:0.4.0.127.0.16.1.1.2.1"/>
                                <code value="10221000"/>
                                <display value="Film-coated tablet"/>
                            </coding>
                        </form>
                        <amount>
                            <numerator>
                                <value value="40"/>
                                <unit value="Piece(s)"/>
                                <system value="http://unitsofmeasure.org"/>
                                <code value="{Piece}"/>
                            </numerator>
                            <denominator>
                                <value value="1"/>
                                <unit value="Package"/>
                                <system value="http://unitsofmeasure.org"/>
                                <code value="{Package}"/>
                            </denominator>
                        </amount>
                        <ingredient>
                            <itemCodeableConcept>
                                <coding>
                                    <system value="http://snomed.info/sct"/>
                                    <code value="387517004"/>
                                    <display value="Paracetamol (substance)"/>
                                </coding>
                                <text value="Paracétamol"/>
                            </itemCodeableConcept>
                            <strength>
                                <numerator>
                                    <value value="1"/>
                                    <unit value="gram"/>
                                    <system value="http://unitsofmeasure.org"/>
                                    <code value="g"/>
                                </numerator>
                                <denominator>
                                    <value value="1"/>
                                    <unit value="Tablet (unit of presentation)"/>
                                    <system value="http://snomed.info/sct"/>
                                    <code value="732936001"/>
                                </denominator>
                            </strength>
                        </ingredient>
                    </Medication>
                </contained>
                <identifier>
                    <system value="urn:ietf:rfc:3986"/>
                    <value value="urn:uuid:20c72d23-246e-4965-9286-02fa0d7818b6"/>
                </identifier>
                <status value="unknown"/>
                <category>
                    <coding>
                        <system value="http://www.whocc.no/atc"/>
                        <code value="N"/>
                        <display value="Nervensystem"/>
                    </coding>
                </category>
                <medicationReference>
                    <reference value="#medication-1"/>
                </medicationReference>
                <subject>
                    <reference value="Patient/MAGMED011"/>
                </subject>
                <informationSource>
                    <reference value="PractitionerRole/pr1"/>
                </informationSource>
                <derivedFrom>
                    <reference value="MedicationStatement/PMP-MedStat" />
                </derivedFrom>
                <derivedFrom>
                    <reference value="Observation/Obs-History" />
                </derivedFrom>
                <derivedFrom>
                    <reference value="Observation/PMP-Obs" />
                </derivedFrom>
                <dosage id="#dosage-1">
                    <timing>
                        <repeat>
                            <when value="MORN"/>
                            <when value="NOON"/>
                            <when value="EVE"/>
                        </repeat>
                    </timing>
                    <asNeededBoolean value="true"/>
                    <route>
                        <coding>
                            <system value="urn:oid:0.4.0.127.0.16.1.1.2.1"/>
                            <code value="20053000"/>
                            <display value="Oral use"/>
                        </coding>
                    </route>
                    <doseAndRate>
                        <doseQuantity>
                            <value value="1"/>
                            <unit value="Tablet (unit of presentation)"/>
                            <system value="http://snomed.info/sct"/>
                            <code value="732936001"/>
                        </doseQuantity>
                    </doseAndRate>
                </dosage>
            </MedicationStatement>
        </resource>
    </entry>

    <entry>
        <fullUrl value="http://test.fhir.ch/r4/Observation/Obs-History"/>
        <resource>
            <Observation>
                <id value="Obs-History"/>
                <identifier>
                    <system value="urn:ietf:rfc:3986"/>
                    <value value="urn:uuid:d862eb3c-d50c-42e4-a231-25623722638b"/>
                </identifier>
                <status value="final"/>
                <code>
                    <coding>
                        <system value="urn:oid:1.3.6.1.4.1.19376.1.9.2.1"/>
                        <code value="COMMENT"/>
                    </coding>
                </code>
                <valueCodeableConcept>
                    <coding>
                        <system value="http://hcisolutions.ch/ig/analyzer/CodeSystem/history-changes"/>
                        <code value="comment"/>
                    </coding>
                </valueCodeableConcept>
            </Observation>
        </resource>
    </entry>

</Bundle>
